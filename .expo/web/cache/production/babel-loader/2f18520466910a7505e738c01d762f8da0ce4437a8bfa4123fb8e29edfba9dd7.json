{"ast":null,"code":"import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import View from\"react-native-web/dist/exports/View\";import Image from\"react-native-web/dist/exports/Image\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Dimensions from\"react-native-web/dist/exports/Dimensions\";import Button from\"react-native-web/dist/exports/Button\";import SettingPushSwitch from\"../../components/SettingPushSwitch\";import{useState,useEffect,useContext}from\"react\";import*as Notifications from\"expo-notifications\";import*as Permissions from\"expo-permissions\";import{getNutrientRoutine}from\"../../api/nutrientRoutine\";import{AuthContext}from\"../../store/auth-context\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var SettingPushScreen=function SettingPushScreen(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isEnabled=_useState2[0],setIsEnabled=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),routines=_useState4[0],setRoutines=_useState4[1];var authContext=useContext(AuthContext);useEffect(function(){fetchRoutines();},[]);useEffect(function(){if(isEnabled&&routines.length>0){scheduleNotifications();}else{cancelScheduledNotifications();}},[isEnabled,routines]);var fetchRoutines=function(){var _ref=_asyncToGenerator(function*(){try{var routinesData=yield getNutrientRoutine(authContext.token);setRoutines(routinesData);}catch(error){console.log(\"Error fetching routines:\",error);}});return function fetchRoutines(){return _ref.apply(this,arguments);};}();var scheduleNotifications=function(){var _ref2=_asyncToGenerator(function*(){var _yield$Permissions$as=yield Permissions.askAsync(Permissions.NOTIFICATIONS),status=_yield$Permissions$as.status;if(status===\"granted\"){routines.forEach(function(routine){var times=routine.times;times.forEach(function(time){var parts=time.split(\":\");var timeObject=new Date();timeObject.setHours(parseInt(parts[0],10));timeObject.setMinutes(parseInt(parts[1],10));timeObject.setSeconds(parseInt(parts[2],10));var notificationTime=timeObject;Notifications.scheduleNotificationAsync({content:{title:routine.productName+\" \\uB4DC\\uC2E4 \\uC2DC\\uAC04\\uC785\\uB2C8\\uB2E4!\",body:routine.productName+\"\\uC774 \\uB2F9\\uC2E0\\uC744 \\uAE30\\uB2E4\\uB9AC\\uACE0 \\uC788\\uC5B4\\uC694. \\uBB3C\\uACFC \\uD568\\uAED8 \\uC12D\\uCDE8\\uD558\\uC138\\uC694.\"},trigger:{hour:notificationTime.getHours(),minute:notificationTime.getMinutes(),repeats:true}});});});}});return function scheduleNotifications(){return _ref2.apply(this,arguments);};}();var cancelScheduledNotifications=function cancelScheduledNotifications(){Notifications.cancelAllScheduledNotificationsAsync();};return _jsxs(View,{style:styles.container,children:[_jsx(View,{style:styles.title,children:_jsx(Image,{style:styles.alarm,source:require(\"../../../assets/SettingAlarm.png\")})}),_jsx(View,{style:styles.alarmWindow,children:_jsx(View,{style:{position:\"absolute\",top:\"10%\"},children:_jsx(SettingPushSwitch,{value:isEnabled,onValueChange:function onValueChange(){return setIsEnabled(function(previousState){return!previousState;});}})})})]});};var styles=StyleSheet.create({container:{flex:1,justifyContent:\"center\",alignItems:\"center\"},title:{position:\"absolute\",top:0,left:0,width:Dimensions.get(\"window\").width,height:\"50%\",backgroundColor:\"#AD94F7\",alignItems:\"center\"},alarm:{position:\"absolute\",top:\"15%\",width:200,height:200},alarmWindow:{position:\"absolute\",top:\"40%\",left:0,bottom:0,right:0,zIndex:10,borderTopLeftRadius:20,borderTopRightRadius:20,backgroundColor:\"#F8F8FA\",justifyContent:\"center\",alignItems:\"center\"}});export default SettingPushScreen;","map":{"version":3,"names":["SettingPushSwitch","useState","useEffect","useContext","Notifications","Permissions","getNutrientRoutine","AuthContext","jsx","_jsx","jsxs","_jsxs","SettingPushScreen","_useState","_useState2","_slicedToArray","isEnabled","setIsEnabled","_useState3","_useState4","routines","setRoutines","authContext","fetchRoutines","length","scheduleNotifications","cancelScheduledNotifications","_ref","_asyncToGenerator","routinesData","token","error","console","log","apply","arguments","_ref2","_yield$Permissions$as","askAsync","NOTIFICATIONS","status","forEach","routine","times","time","parts","split","timeObject","Date","setHours","parseInt","setMinutes","setSeconds","notificationTime","scheduleNotificationAsync","content","title","productName","body","trigger","hour","getHours","minute","getMinutes","repeats","cancelAllScheduledNotificationsAsync","View","style","styles","container","children","Image","alarm","source","require","alarmWindow","position","top","value","onValueChange","previousState","StyleSheet","create","flex","justifyContent","alignItems","left","width","Dimensions","get","height","backgroundColor","bottom","right","zIndex","borderTopLeftRadius","borderTopRightRadius"],"sources":["/Users/jinwook/react-native/daily-pt-frontend/src/screens/SettingScreen/SettingPushScreen.js"],"sourcesContent":["import { View, Image, StyleSheet, Dimensions, Button } from \"react-native\";\nimport SettingPushSwitch from \"../../components/SettingPushSwitch\";\nimport { useState, useEffect, useContext } from \"react\";\nimport * as Notifications from \"expo-notifications\";\nimport * as Permissions from \"expo-permissions\";\nimport { getNutrientRoutine } from \"../../api/nutrientRoutine\";\nimport { AuthContext } from \"../../store/auth-context\";\n\nconst SettingPushScreen = () => {\n  const [isEnabled, setIsEnabled] = useState(false);\n  const [routines, setRoutines] = useState([]);\n  const authContext = useContext(AuthContext);\n\n  useEffect(() => {\n    fetchRoutines();\n  }, []);\n\n  useEffect(() => {\n    if (isEnabled && routines.length > 0) {\n      scheduleNotifications();\n    } else {\n      cancelScheduledNotifications();\n    }\n  }, [isEnabled, routines]);\n\n  const fetchRoutines = async () => {\n    try {\n      const routinesData = await getNutrientRoutine(authContext.token); // Call your API function to fetch the routines\n      setRoutines(routinesData);\n    } catch (error) {\n      console.log(\"Error fetching routines:\", error);\n    }\n  };\n\n  const scheduleNotifications = async () => {\n    const { status } = await Permissions.askAsync(Permissions.NOTIFICATIONS);\n    if (status === \"granted\") {\n      routines.forEach((routine) => {\n        const { times } = routine; // Assuming the routine object has a \"times\" property containing the scheduled times\n        times.forEach((time) => {\n          const parts = time.split(\":\");\n          const timeObject = new Date();\n          timeObject.setHours(parseInt(parts[0], 10));\n          timeObject.setMinutes(parseInt(parts[1], 10));\n          timeObject.setSeconds(parseInt(parts[2], 10));\n          const notificationTime = timeObject; // Convert the time string to a Date object\n          Notifications.scheduleNotificationAsync({\n            content: {\n              title: `${routine.productName} 드실 시간입니다!`,\n              body: `${routine.productName}이 당신을 기다리고 있어요. 물과 함께 섭취하세요.`,\n            },\n            trigger: {\n              hour: notificationTime.getHours(),\n              minute: notificationTime.getMinutes(),\n              repeats: true, // Set to true if the notification should repeat daily at the same time\n            },\n          });\n        });\n      });\n    }\n  };\n\n  const cancelScheduledNotifications = () => {\n    Notifications.cancelAllScheduledNotificationsAsync();\n  };\n\n  return (\n    <View style={styles.container}>\n      <View style={styles.title}>\n        <Image\n          style={styles.alarm}\n          source={require(\"../../../assets/SettingAlarm.png\")}\n        />\n      </View>\n\n      <View style={styles.alarmWindow}>\n        <View style={{ position: \"absolute\", top: \"10%\" }}>\n          <SettingPushSwitch\n            value={isEnabled}\n            onValueChange={() =>\n              setIsEnabled((previousState) => !previousState)\n            }\n          />\n        </View>\n      </View>\n    </View>\n  );\n};\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  title: {\n    position: \"absolute\",\n    top: 0,\n    left: 0,\n    width: Dimensions.get(\"window\").width,\n    height: \"50%\",\n    backgroundColor: \"#AD94F7\",\n    alignItems: \"center\",\n  },\n  alarm: {\n    position: \"absolute\",\n    top: \"15%\",\n    width: 200,\n    height: 200,\n  },\n  alarmWindow: {\n    position: \"absolute\",\n    top: \"40%\",\n    left: 0,\n    bottom: 0,\n    right: 0,\n    zIndex: 10,\n    borderTopLeftRadius: 20,\n    borderTopRightRadius: 20,\n    backgroundColor: \"#F8F8FA\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n});\n\nexport default SettingPushScreen;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}